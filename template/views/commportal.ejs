<html>
    <head>
       <style>
/*
		   .container{
			   margin-left:20%;
			   margin-right:10%;
		   }
*/
           h3{
               color:gray;
           }
    #image2
{
    height:30px;
    width:30px;
}
		   #list{
			   font-size:10px
		   }
           .member
           {
               font-size:20px;
               margin-left:300px;
			   margin-top:100px;
           }
           input{
               height:100px;
               width:1000px;
           }
           #distitle
           {
               height:50px;
           }
    #insert{
margin-left:400;
font-size:30px;
}
    #commpic
{
    width:130px;
    height:130px;
    margin-left:250px;
    margin-top:20px;
    border:solid;
border-color:grey;
    box-shadow:0 0 10px black;
}

    .innerbtn1
{
    background-color:royalblue;
    border-color: royalblue;
    color:white;
    height:50px;
    width:100px;
}
#head
{
    font-weight: bold;
    background-color: darkblue;
    color: white;
    box-shadow: 0 0 10px;
    width:100%;
    position:sticky;
}
           .main
           {
               width:80%;
               border-color: black;
               height:20px;
                height: 85vh;
               
    display: flex;
}
        
		.textbox
           {
              margin :10px;  
			           }
           .head
           {
               background-color: lightgray;
               width:100%;
               text-align: center;
               height:40px;
               font-size: 25px;
           }
           .content
           {
               background-color: white;
               width:100%;
               text-align: center;
               height:35px;
               font-size: 20px;
		}
		div{
			height:100px;
		}
            .outer
           {
               width:700px;
               margin-left:100px;
               border-color:darkgray;
            box-shadow: 0 0 5px darkgray;
               margin-top:0px;
           }
        
.vl {
  border-left: 1px solid lightgray;
  height: 300px;
  position: absolute;
  left: 40%;
  margin-left: -3px;
  top: 0;
	margin-top:250px;
		   }
             .about
           {
               background-color: lightgray;
               width:700px;
               text-align: center;
               align-content: center;
               align-items: center;
               justify-content: center;
               height:40px;
               font-size: 25px;
           }
           .desc
           {
               background-color: white;
                text-align: center;
               align-content: center;
               align-items: center;
               justify-content: center;
               height:100px;
               font-size: 25px;
               width:700px;
           }
     .content1
           {
               background-color: white;
               width:300px;
               text-align: center;
               align-content: center;
               align-items: center;
               justify-content: center;
               height:80px;
               font-size: 25px;
           }
           #boxes
           {
               width:1000px;
           }
           #image
           {
               width:50px;
               height:50px;
               border-color:black;
           }
           img
           {
               border-color: black;
           }
          #btn
           {
               background-color: darkblue;
               color:white;
               border-color: darkblue;
               height:40px;
               width:200px;
           }
           .button
           {
               background-color: darkblue;
               color:white;
               border-color: darkblue;
               width:100px;
           }
           
.sidenav {
  height: 100%;
  width: 0;
  position: fixed;
  z-index: 1;
  top: 0;
  left: 0;
  background-color: #111;
  overflow-x: hidden;
  transition: 0.5s;
  padding-top: 60px;
}

.sidenav a {
/*  padding: 8px 8px 8px 32px;*/
  text-decoration: none;
  font-size: 25px;
  color: #818181;
/*  display: block;*/
  transition: 0.3s;
}

.sidenav a:hover {
  color: #f1f1f1;
}

.sidenav .closebtn {
  position: absolute;
  top: 0;
  right: 25px;
  font-size: 36px;
/*  margin-left: 50px;*/
}

@media screen and (max-height: 450px) {
  .sidenav {padding-top: 15px;}
  .sidenav a {font-size: 18px;}
}
           	@media(max-width: 800px){
  		.mobile-responsive{
  			display: none;
  		}
  	}
           @media only screen and (max-width: 1024px){
    header{
        font-size: 18px;
    }
    .main{
        width: 80%;
        box-shadow: 0px 0px 6px;
    }
               .head{
        width: 100%;
    }
               .content{
                        width:100%;
               }
    /*input{
        font-size: 18px;
    }*/
    footer h5{
        font-size: 14px;
    }
}
#image1 {
    width: 150px;
    height: 150px;
    border-radius:70px;
    
}
        
        .innerhead
           {
               width:100%;
               background-color:royalblue;
               height:50px;
               color:white;
           }
.innerbtn
{
    background-color: royalblue;
    border-color:royalblue;
    height:35px;
    width:100px;
    color:white;
    margin-top:10px;
    float:right;
    margin-right:20px;
}
#join
{
    background-color: royalblue;
    border-color:royalblue;
    height:35px;
    width:100px;
    color:white;
    margin-top:17px;
    font-size:17px;
    float:center;
}
#tojoin
{
    margin-left: 300px;
}
        
#textbox{
    
      box-shadow:0 0 10px black;
}
        #create
        {
            width:100px;
           }</style>
        <title>MeetGreet</title>
    
</head>
      
 
      
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
        
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">

       <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">   
    <body onload="sendreq()">
	<%if(user.toUser==1){
		%> <% include partials/tempheader %> <%
	}
	else{%><%include partials/headeruser %><%
	}%>
              
     <div class="innerhead">
       <a href="">  <img src="../../community.jpg"  id="commpic"></a>
      </div>
<br><br>
             <a id="insert" href=""></a>
                 <hr width="1000px" size="100px">
                 <div class="container">
              <div class="row">
              	<div class="col-12 col-xl-3 col-lg-3 col-md-12 col-sm-12 col-xs-12">
               <div class="textbox">
				   <div class="head"><button id="rule" class="btn btn-primary" style="height:90%;text-align:center;margin-top:1%" onclick="joinbutpress()"></button></div>
                <div class="content"><p id="members">Members</p></div>
				</div>
      	</div>
      	<div class="col-12 col-xl-9 col-lg-9 col-md-12 col-sm-12 col-xs-12">
               <div class="textbox">
                <div class="head"><p>About Community</p></div>
                <div class="content"><p id="desc"></p></div>
				</div>
      	</div>
       		<div class="col-12 col-xl-3 col-lg-3 col-md-12 col-sm-12 col-xs-12">
               <div class="textbox">
                <div class="head"><p>Managers</p></div>
                <div class="content"><li id="list"></li></div>
				</div>
      	</div>
              </div>
		</div>        
    </body>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>     
       <script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <script>
     var curruser=[];
	  var currentuser;
		var url;
				var result=new Object();
        function    sendreq(){		
			currentuser=window.location.href.substring(window.location.href.lastIndexOf('/') + 1).replace("-"," ");
			 var xhr=new XMLHttpRequest();
            xhr.open("GET",`/getphoto/${currentuser}`);
            xhr.send();
            xhr.onreadystatechange=function(){
                               if (this.readyState == 4 && this.status == 200) {
                                   console.log((this.responseText));
                                   var  path=this.responseText;
                                   console.log(path);
                                   if(path){
									   path=path.slice(7,path.length);
                                 	 	path="../../"+path;
//									   document.getElementById("commpic").setAttribute("src",path);
//								   }
							 document.getElementById("imagee").setAttribute("src",path);
								if(document.getElementById("image1"))
                                   document.getElementById("image1").setAttribute("src",path);
                                   }
								   else
									   {
										 if(document.getElementById("image1"))
										 document.getElementById("image1").setAttribute("src","../../logo.jpg");
										    document.getElementById("imagee").setAttribute("src","../../logo.jpg");
									   }
                               }
            };
			 url = $(location).attr('href').split( '/' );

			var xhttp=new XMLHttpRequest();
			xhttp.open("GET",`/getcommphoto/${url[url.length-2]}`);
			xhttp.send();
			xhttp.onreadystatechange=function(){
				if (this.readyState == 4 && this.status == 200) {
                                   console.log((this.responseText));
                                   var  path=(this.responseText);
                                   console.log(path);
                                   if(path){
									   path=path.slice(7,path.length);
                                 	 	path="../../"+path;
									   document.getElementById("commpic").setAttribute("src",path);
								   }
			}
		};
		
		var xhr1=new XMLHttpRequest();
		xhr1.open("GET",`/comminfo/${url[url.length-2]}`);
		xhr1.send();
		xhr1.onload=function(){
			if(this.status==200){
				result=JSON.parse(this.responseText);
				console.log(result[0]);
				document.getElementById("members").innerHTML+="("+(result[0].Members.length)+")";
				document.getElementById("insert").innerHTML=result[0].Name;
				if(result[0].Rule=="Direct")
				document.getElementById("rule").innerHTML="JOIN";
				else
				document.getElementById("rule").innerHTML="ASK TO JOIN";
				document.getElementById("desc").innerHTML=result[0].Description;
				var li=document.createElement("h3");
            var obj=new Object();
                 obj.Email=result[0].Owner;
                 var    xhro=new XMLHttpRequest();
            document.getElementById("list").innerHTML='';
                                 xhro.open("POST",'/findUser');
                                 xhro.setRequestHeader("content-type","application/json");
                                 xhro.send(JSON.stringify(obj));
                                 xhro.onreadystatechange=function(){
                                   if(this.readyState==4    &&  this.status==200)
                                       {
                                           var  owner1=(JSON.parse(this.responseText));
                                           var  taga=document.createElement("a");
										   taga.setAttribute("style","font-size:15px");
										   taga.setAttribute('href',`/viewprofile/${owner1[0]._id}/${currentuser}`);
                                           taga.setAttribute("id","own");
                                           var  img=document.createElement("img");
                                           img.setAttribute("src","../../logo.jpg");
                                           img.setAttribute("id","image2");
                                           if(owner1[0].final){
                                           var  path=owner1[0].final.path;
										   path=path.slice(7,path.length);
                                      
                                   			if(path){
												path="../../"+path
												img.setAttribute("src",path);
											}
                                           }
                                                taga.appendChild(img);
                                          taga.innerHTML+="&nbsp;&nbsp;"+owner1[0].Name;
                                           li.appendChild(taga);
                                           li.innerHTML+="<br>";
										   console.log(li.innerHTML);
                                                         document.getElementById("list").appendChild(li);
                                        
                                       }
                                 };
			}
		}
		}

		function joinbutpress() {
        var requests = new XMLHttpRequest();
        requests.open('post', "/community/joinrequest");
        requests.setRequestHeader("Content-Type", "Application/JSON")
        requests.send(JSON.stringify({
            "id": url[url.length-2],
        }));
        requests.addEventListener('load', function () {
            if (requests.status === 200) {
                var results = JSON.parse(requests.responseText);
                console.log(results);
                window.location.href=`/searchcomm/${currentuser}`;
            }
        });
    }
    </script>
   
</html>